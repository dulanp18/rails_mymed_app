<div class="container">
  <div>
    <h1> Consultation with <%= @consultation.patient.user.first_name  %> <%= @consultation.patient.user.last_name  %></h1>
  </div>
  <div>
    <% if @consultation.prescriptions.length == 0 %>
      <h2>No medicine prescribed yet.</h2>
    <% else %>
    <%= simple_form_for Order.new do |f| %>
      <%= f.input 'prescriptions', collection: @consultation.prescriptions.map { |prescription| ["#{prescription.medicine.name} - #{prescription.medicine.strength_of_medicine} - Take #{prescription.amount_per_serving.to_i}. #{prescription.servings_per_day.to_i} per day, #{prescription.number_of_days.to_i}. #{prescription.comment}", prescription.id]}, as: :check_boxes %>
      <%= f.input 'consultation_id', input_html: { value: @consultation.id }, as: :hidden %>
      <%= f.submit %>
    <% end %>
      <% @consultation.prescriptions.each do |prescription|  %>
        <div>
          <%= prescription.medicine.name %> - <%= prescription.medicine.strength_of_medicine  %> - Take <%= prescription.amount_per_serving.to_i  %>, <%= prescription.servings_per_day.to_i  %> per day, for <%= prescription.number_of_days.to_i  %> days. <%= prescription.comment  %>
              <p>Price: <%= humanized_money_with_symbol(prescription.price) %> </p>

              <%= simple_form_for OrderItem.new do |f| %>
                <%= f.input 'prescription_id', input_html: {value: prescription.id}, as: :hidden %>
                <%= f.submit 'Add to cart', class: 'btn btn-primary' %>
              <% end %>
        </div>
      <% end %>
    <% end %>
  </div>

  <% if current_user.user_type == 'patient' %>
    <div>
      <%= link_to "Back To All Consultations", consultations_path %>
    </div>
  <% end %>
  <div>
    <% if current_user.user_type == 'doctor' %>
      <%= simple_form_for [@consultation, @prescription] do |f| %>

        <%= simple_fields_for :other do |o| %>
        <div class="d-flex">
          <%= o.input :name, label: 'Name' %>
          <%= o.input :strength_of_medicine, label: 'Strength of Medicine' %>
        <% end %>
        </div>
        <div class="d-flex">
          <%= f.input :amount_per_serving %>
          <%= f.input :servings_per_day %>
          <%= f.input :number_of_days %>
        </div>
          <%= f.input :comment %>
          <%= f.button :submit, "Prescribe" %>
      <% end %>

      <%= link_to "Complete Consultation", consultations_path %>

    <% end %>
  </div>
</div>
